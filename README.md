# Excel Insights

Excel Insights is a Streamlit application for turning raw Excel workbooks into structured tables you can explore, tweak, and share. Upload one or more spreadsheets, describe how each sheet is laid out, and the app will parse them into clean data frames you can review inside the browser.

## Features
- Multi-file uploader for `.xlsx` and `.xls` workbooks with per-sheet parsing controls
- Configurable table name, header, unit, and data starting rows (Excel-style indexing)
- Save, import, and download parsing presets in `.excel_configs.json`
- Polars-backed parsing for fast extraction of large sheets
- Placeholder "Insights" tab ready for future LLM-powered analysis workflows

## Prerequisites
- Python 3.10+
- Optional but recommended: [Poetry](https://python-poetry.org/) for dependency management
- System packages required by Streamlit/Polars (see their docs if install errors appear)

## Installation
```bash
# clone the repository, then from the project root
poetry install

# or, if you prefer pip
pip install .
```
> Tip: If you use pip, make sure you are in a virtual environment and that build dependencies are available (PEP 517 install).

## Running the app
```bash
poetry run streamlit run app.py
# or
streamlit run app.py
```
The Streamlit UI will open in your browser. Use the sidebar to stop or rerun the app while iterating on parsing settings.

## Using the parser
1. Open the **Config Management** tab.
2. Optionally upload a configuration JSON file generated by the app (see below).
3. Upload one or more Excel files. Each sheet gets its own controls:
   - Toggle whether the sheet has a table name row or unit row.
   - Set the 1-based row numbers for the table name, headers, units, and where the data begins.
4. Click the **Parse** button next to a sheet to parse only that sheet, or **Parse All Sheets** to parse the entire workbook with the stored configuration.
5. Review the parsed output under **Parsed Tables**. The app shows the detected table name, headers, units, and a preview of the data.

## Managing configurations
The app keeps parsing presets in `.excel_configs.json` at the project root. You can:
- **Save Configs**: persist the current in-session configuration to `.excel_configs.json`.
- **Import Configs**: load presets from the default file or an uploaded JSON.
- **Download Current Configs**: export the in-session configuration as `excel_configs.json`.

Configuration entries use `"<filename>_<sheet>"` keys. Example:
```json
{
  "302_Geometry.xlsx_Connectivity - Area": {
    "name": 1,
    "header": 2,
    "unit": 3,
    "data": 5
  }
}
```
A `null` (`None` in Python) value means that element is disabled in the UI (for example, omit the unit row).

## Environment variables
Populate `.env` if you need to pass secrets (e.g., API keys for the future Insights tab). Streamlit automatically reads environment variables available in the shell you use to launch the app.

## Development notes
- Core parsing logic lives in `excel_insights/parser.py` and uses Polars for fast DataFrame construction.
- UI helpers for configuration management are in `excel_insights/ui_components/`.
- There are currently no automated tests; consider adding `pytest` coverage for parser edge cases before extending the app.

## Troubleshooting
- **Install errors on Windows:** ensure you have the Microsoft C++ Build Tools installed for packages that ship native extensions.
- **Polars engine issues:** switch engines in `parse_excel_sheet` (for example, set `engine="pyxlsb"`) if you work with exotic Excel formats.
- **Streamlit caching:** use the "Clear cache" option in the Streamlit menu if stale data appears after updating configurations.
